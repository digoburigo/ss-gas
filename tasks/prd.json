{
  "name": "Sistema de Gestão de Consumo de Gás Natural - RC",
  "branchName": "feature/gas-consumption-management",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add ZenStack models to schema.zmodel",
      "description": "Add all gas consumption related models (Unit, Equipment, EquipmentConstant, DailyEntry, LineStatus, DailyPlan, RealConsumption, Contract) to the ZenStack schema file",
      "acceptanceCriteria": [
        "All enums defined (EquipmentType, ConsumptionUnit, LineStatusValue, ConsumptionSource)",
        "Unit model with organization relation and equipment array",
        "Equipment model with unit relation and constants array",
        "EquipmentConstant model with effective date range",
        "DailyEntry model with all fields and unique constraint on unitId+date",
        "LineStatus model with entry and equipment relations",
        "DailyPlan model with approval workflow fields",
        "RealConsumption model with source tracking",
        "Contract model with tolerance band fields",
        "Access policies defined for all models"
      ],
      "priority": 1,
      "passes": true,
      "dependsOn": [],
      "labels": [
        "infrastructure",
        "database"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-002",
      "title": "Run database generation and migration",
      "description": "Execute db:generate and db:push commands to apply the new schema to the database",
      "acceptanceCriteria": [
        "ZenStack files generated successfully",
        "Database schema updated with new tables",
        "No migration errors"
      ],
      "priority": 1,
      "passes": true,
      "dependsOn": [
        "US-001"
      ],
      "labels": [
        "infrastructure",
        "database"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-003",
      "title": "Create seed script for units and equipment",
      "description": "Create a seed script that populates the database with the three units (Criciúma, Urussanga, Botucatu) and their respective equipment with consumption rates",
      "acceptanceCriteria": [
        "Criciúma unit created with code CRI and all equipment (Atomizador + Lines 0-7)",
        "Urussanga unit created with code URU and equipment (Atomizador + Lines 1-2)",
        "Botucatu unit created with code BOT and equipment (ATM 250, ATM 052, Lines 1-2, Secador 2)",
        "Equipment constants set with correct consumption rates",
        "Default contract created with QDC 134,800 m³/d and tolerance bands"
      ],
      "priority": 1,
      "passes": true,
      "dependsOn": [
        "US-002"
      ],
      "labels": [
        "infrastructure",
        "seed-data"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-004",
      "title": "Set up gas module structure in server",
      "description": "Create the gas module folder structure in apps/server/src/modules/gas with controller and service files",
      "acceptanceCriteria": [
        "Gas module folder created at apps/server/src/modules/gas/",
        "gas.controller.ts file created with Elysia setup",
        "Module registered in main server app"
      ],
      "priority": 1,
      "passes": true,
      "dependsOn": [
        "US-003"
      ],
      "labels": [
        "infrastructure",
        "backend"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-005",
      "title": "Implement GasCalculationService",
      "description": "Create the gas calculation service with methods for calculating QDC atomizer, QDC lines, QDS, and contract deviations",
      "acceptanceCriteria": [
        "calculateQdcAtomizer method handles single and dual atomizer scenarios",
        "calculateQdcLines method sums consumption for ON lines only",
        "calculateQds method combines atomizer and lines consumption",
        "calculateDeviations method computes transport and molecule tolerances",
        "Deviation status (within/exceeded) correctly determined"
      ],
      "priority": 2,
      "passes": true,
      "dependsOn": [
        "US-004"
      ],
      "labels": [
        "backend",
        "business-logic"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-006",
      "title": "Create daily entry API endpoints",
      "description": "Implement POST and GET endpoints for daily entries with validation and auto-calculation",
      "acceptanceCriteria": [
        "POST /gas/units/:unitId/entries creates new entry with validation",
        "Entry validation ensures hours 0-24, valid equipment IDs",
        "Auto-calculation of qdcAtomizer, qdcLines, qdsCalculated on save",
        "GET /gas/units/:unitId/entries returns entries for a month",
        "Query parameter month in YYYY-MM format",
        "Entries returned with line statuses populated"
      ],
      "priority": 2,
      "passes": true,
      "dependsOn": [
        "US-005"
      ],
      "labels": [
        "backend",
        "api"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-007",
      "title": "Build unit entry form component",
      "description": "Create the daily data entry form component for unit operators with unit-specific fields using Base UI",
      "acceptanceCriteria": [
        "Date picker with auto-populated today's date",
        "Atomizer scheduled toggle (Yes/No)",
        "Atomizer hours input (0-24 numeric)",
        "Secondary atomizer fields shown only for Botucatu",
        "Production line toggles rendered based on unit equipment",
        "Observations text field",
        "Real-time QDS calculation displayed"
      ],
      "priority": 2,
      "passes": true,
      "dependsOn": [
        "US-006"
      ],
      "labels": [
        "frontend",
        "forms"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-008",
      "title": "Add form validation and auto-calculation",
      "description": "Implement client-side validation and real-time auto-calculation in the entry form",
      "acceptanceCriteria": [
        "Hours field validates 0-24 range",
        "Required fields validated before submit",
        "QDS value updates as user changes inputs",
        "Manual override option available for QDS",
        "Visual feedback on validation errors",
        "Submit button disabled when form invalid"
      ],
      "priority": 2,
      "passes": true,
      "dependsOn": [
        "US-007"
      ],
      "labels": [
        "frontend",
        "validation"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-009",
      "title": "Create consolidated dashboard route",
      "description": "Set up the main gas dashboard route at /gas with TanStack Router",
      "acceptanceCriteria": [
        "Route created at apps/web/src/routes/gas/index.tsx",
        "GasDashboard component renders",
        "Route protected by authentication",
        "Breadcrumb navigation in place"
      ],
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "US-008"
      ],
      "labels": [
        "frontend",
        "routing"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-010",
      "title": "Implement consolidated data API endpoint",
      "description": "Create GET /gas/consolidated endpoint that aggregates data across all units",
      "acceptanceCriteria": [
        "Endpoint accepts month query parameter (YYYY-MM)",
        "Returns daily summary with QDC, QDS, QDP, QDR totals",
        "Calculates status (OK/NOK) for each day",
        "Includes tolerance band status per day",
        "Data grouped by date with unit breakdown available"
      ],
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "US-006"
      ],
      "labels": [
        "backend",
        "api"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-011",
      "title": "Build summary cards with Base UI",
      "description": "Create dashboard summary cards showing QDC, QDS, QDP, QDR values with visual styling",
      "acceptanceCriteria": [
        "QDC card shows contracted daily quantity (134,800 m³)",
        "QDS card shows calculated/forecasted consumption",
        "QDP card shows programmed quantity",
        "QDR card shows real consumption from meters",
        "Cards styled with appropriate colors and icons",
        "Values formatted with thousand separators and units"
      ],
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "US-009",
        "US-010"
      ],
      "labels": [
        "frontend",
        "dashboard"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-012",
      "title": "Add tolerance band visualization",
      "description": "Implement visual indicators showing tolerance band status (green/yellow/red) on the dashboard",
      "acceptanceCriteria": [
        "Green indicator when within tolerance bands",
        "Yellow indicator when approaching limits (5% from boundary)",
        "Red indicator when tolerance exceeded",
        "Transport tolerance (±20%/+10%) displayed",
        "Molecule tolerance (±5%) displayed",
        "Tooltip with exact values on hover"
      ],
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "US-011"
      ],
      "labels": [
        "frontend",
        "visualization"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-013",
      "title": "Build Petrobras export functionality",
      "description": "Create the report export feature for generating Petrobras-formatted XLSX files",
      "acceptanceCriteria": [
        "GET /gas/reports/petrobras endpoint accepts month parameter",
        "Preview endpoint returns data before export",
        "Download generates XLSX with correct column structure",
        "Filename follows pattern: RC_{MONTH}_{YEAR}_Petrobras.xlsx",
        "All daily entries for the month included",
        "Contract tolerance data included"
      ],
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "US-010"
      ],
      "labels": [
        "backend",
        "reports",
        "export"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-014",
      "title": "Create react-email templates",
      "description": "Create email templates for missing entry alerts and other notifications using react-email",
      "acceptanceCriteria": [
        "MissingDailyEntryEmail template created",
        "Template includes user name, unit name, date",
        "Link to entry form included in email",
        "Template renders correctly in email clients",
        "Portuguese content used"
      ],
      "priority": 4,
      "passes": true,
      "dependsOn": [
        "US-004"
      ],
      "labels": [
        "email",
        "notifications"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-015",
      "title": "Implement NotificationService with Resend",
      "description": "Create the notification service that sends emails using Resend integration",
      "acceptanceCriteria": [
        "NotificationService class created in apps/server/src/services/",
        "Resend client configured with API key from environment",
        "sendMissingEntryAlert method implemented",
        "Email rendered from react-email template",
        "Correct from address and subject line"
      ],
      "priority": 4,
      "passes": true,
      "dependsOn": [
        "US-014"
      ],
      "labels": [
        "backend",
        "notifications",
        "email"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-016",
      "title": "Set up scheduled jobs for alerts",
      "description": "Create scheduled tasks that check for missing entries and send alerts at 6 PM daily",
      "acceptanceCriteria": [
        "Scheduled job runs at 6 PM local time",
        "Job checks all units for missing entries for current day",
        "Email sent to unit operators if entry missing",
        "Escalation email sent to supervisor after 2 hours (8 PM)",
        "Job logs execution results"
      ],
      "priority": 4,
      "passes": true,
      "dependsOn": [
        "US-015"
      ],
      "labels": [
        "backend",
        "scheduled-tasks"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-017",
      "title": "Add notification preferences to user settings",
      "description": "Add user settings to control notification preferences for email alerts",
      "acceptanceCriteria": [
        "User can enable/disable missing entry alerts",
        "User can set preferred notification time",
        "Supervisor escalation can be configured",
        "Settings saved to user profile",
        "Settings UI accessible from user menu"
      ],
      "priority": 4,
      "passes": true,
      "dependsOn": [
        "US-016"
      ],
      "labels": [
        "frontend",
        "settings",
        "notifications"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-018",
      "title": "Create admin page for equipment configuration",
      "description": "Build the admin page at /gas/admin for managing equipment constants",
      "acceptanceCriteria": [
        "Route created at apps/web/src/routes/gas/admin.tsx",
        "List all units with their equipment",
        "Edit consumption rate for any equipment",
        "Set effective date for constant changes",
        "Add notes explaining changes",
        "Historical constants viewable in audit log"
      ],
      "priority": 4,
      "passes": true,
      "dependsOn": [
        "US-009"
      ],
      "labels": [
        "frontend",
        "admin"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-019",
      "title": "Create reports page with date filter",
      "description": "Build the reports page at /gas/reports with month selection and export options",
      "acceptanceCriteria": [
        "Route created at apps/web/src/routes/gas/reports.tsx",
        "Month selector for date range",
        "Preview table showing monthly data",
        "Download button for Petrobras export",
        "Loading state during export generation"
      ],
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "US-013"
      ],
      "labels": [
        "frontend",
        "reports"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-020",
      "title": "Add monthly trend chart to dashboard",
      "description": "Implement a chart visualization showing consumption trends over the selected month",
      "acceptanceCriteria": [
        "Line chart showing daily QDS, QDP, QDR values",
        "X-axis shows dates of the month",
        "Y-axis shows consumption in m³",
        "Tolerance bands shown as shaded regions",
        "Chart legend for each metric",
        "Interactive tooltips on hover"
      ],
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "US-012"
      ],
      "labels": [
        "frontend",
        "charts",
        "visualization"
      ],
      "completionNotes": "Completed by agent"
    }
  ],
  "metadata": {
    "updatedAt": "2026-01-20T04:51:39.117Z"
  }
}